<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動貓咪餵養系統</title>
    <style>
        /* 響應式佈局核心設定 */
        :root {
            --primary-color: #FFB6C1;
            --secondary-color: #87CEFA;
            --transition-speed: 0.3s;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        #cat-container {
            position: relative;
            width: min(90vw, 600px);
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 1rem;
            backdrop-filter: blur(10px);
        }

        #cat {
            width: 100%;
            height: auto;
            transition: transform 0.5s ease-in-out;
            cursor: pointer;
        }

        #cat:hover {
            transform: scale(1.05) rotate(2deg);
        }

        .status-display {
            text-align: center;
            font-size: 1.5rem;
            color: #333;
            margin: 1rem 0;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border: 2px solid var(--primary-color);
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            background: var(--primary-color);
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 480px) {
            #cat-container {
                padding: 1rem;
            }
            
            button {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="cat-container">
        <div class="status-display" id="status-text">目前狀態：正常</div>
        <img 
            id="cat" 
            src="./assets/images/normal.png" 
            alt="電子寵物貓"
            data-states='{
                "normal": "./assets/images/normal.png?v=20250405",
                "hungry": "./assets/images/hungry.png?v=20250405",
                "happy": "./assets/images/happy.png?v=20250405"
            }'>
        
        <div class="control-panel">
            <button id="feed-btn">餵食貓咪</button>
            <button id="play-btn">玩耍互動</button>
            <button id="reset-btn">重置狀態</button>
        </div>
    </div>

    <script>
        // 狀態機配置參數
        const STATE_CONFIG = {
            normal: { 
                next: 'hungry', 
                duration: 5000,
                sound: 'meow.mp3'
            },
            hungry: {
                next: 'happy',
                duration: 3000,
                sound: 'eating.mp3'
            },
            happy: {
                next: 'normal',
                duration: 7000,
                sound: 'purr.mp3'
            }
        };

        // 核心邏輯控制器
        class CatStateMachine {
            constructor() {
                this.catImage = document.getElementById('cat');
                this.statusText = document.getElementById('status-text');
                this.stateData = JSON.parse(this.catImage.dataset.states);
                this.currentState = 'normal';
                this.initEventListeners();
                this.autoTransition();
            }

            initEventListeners() {
                document.getElementById('feed-btn').addEventListener('click', () => this.changeState('happy'));
                document.getElementById('play-btn').addEventListener('click', () => this.changeState('hungry'));
                document.getElementById('reset-btn').addEventListener('click', () => this.resetState());
                this.catImage.addEventListener('error', (e) => this.handleImageError(e));
            }

            changeState(newState) {
                if (this.validateStateTransition(newState)) {
                    this.currentState = newState;
                    this.updateDisplay();
                    this.playSound();
                    this.autoTransition();
                }
            }

            validateStateTransition(targetState) {
                const allowedTransitions = {
                    normal: ['hungry'],
                    hungry: ['happy'],
                    happy: ['normal']
                };
                return allowedTransitions[this.currentState].includes(targetState);
            }

            updateDisplay() {
                this.catImage.src = this.stateData[this.currentState];
                this.statusText.textContent = `目前狀態：${this.getLocalizedState()}`;
            }

            getLocalizedState() {
                const localization = {
                    normal: '正常',
                    hungry: '飢餓',
                    happy: '開心'
                };
                return localization[this.currentState];
            }

            autoTransition() {
                clearTimeout(this.transitionTimer);
                this.transitionTimer = setTimeout(() => {
                    this.changeState(STATE_CONFIG[this.currentState].next);
                }, STATE_CONFIG[this.currentState].duration);
            }

            resetState() {
                this.currentState = 'normal';
                this.updateDisplay();
                this.autoTransition();
            }

            playSound() {
                const audio = new Audio(`./assets/sounds/${STATE_CONFIG[this.currentState].sound}`);
                audio.play().catch(() => console.log('需要使用者互動才能播放音效'));
            }

            handleImageError(event) {
                console.error('圖片載入失敗:', event.target.src);
                event.target.src = './assets/images/fallback.png';
            }
        }

        // 初始化狀態機
        window.addEventListener('DOMContentLoaded', () => new CatStateMachine());
    </script>
</body>
</html>

